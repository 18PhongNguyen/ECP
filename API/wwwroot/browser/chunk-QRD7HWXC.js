import{a as ee}from"./chunk-VEYBNXGU.js";import{a as M,c as Le}from"./chunk-MK2QDP6Y.js";import{a as X}from"./chunk-SDXA3ZPX.js";import{a as Ve,b as Be,c as ue,d as Y,e as Ue,f as Z}from"./chunk-FIL4IH3V.js";import{n as Ge}from"./chunk-3JLWCHR4.js";import{b as je,c as k,f as O,g as T,k as Ae,m as R,n as D,o as L,p as K,q as x}from"./chunk-UUXI5M4A.js";import{a as qe,b as ze}from"./chunk-77MEREZP.js";import{a as P}from"./chunk-GUPPVHVY.js";import{Ba as S,C as ge,Ca as v,F as f,Fa as de,Ga as xe,Gb as W,Hb as J,Ia as q,Ja as z,Ka as H,Kb as De,L as ye,La as Fe,Lb as $,M as I,Ma as m,N as w,Na as G,Oa as _e,Pa as Ie,Qa as we,Ra as h,S as Se,Xa as Ne,Ya as Me,Z as c,_ as p,bb as Pe,ga as be,i as ve,ia as g,j as he,ka as s,kb as Q,lb as b,ma as ke,nb as Oe,rb as Te,sa as a,sb as y,ta as n,ua as l,wb as Re,xa as Ee,ya as N,z as Ce}from"./chunk-LQR3BN6S.js";import{d as U}from"./chunk-4CLCTAJ7.js";function rt(i,e){if(i&1&&(a(0,"button",5),m(1," View your order "),n()),i&2){let t=v();xe("routerLink","/orders/",t.order.id,"")}}function it(i,e){i&1&&(a(0,"button",6),m(1," View your orders "),n())}var te=class i{constructor(e){this.router=e;let t=this.router.getCurrentNavigation();this.order=t?.extras?.state}order;static \u0275fac=function(t){return new(t||i)(p(W))};static \u0275cmp=f({type:i,selectors:[["app-checkout-success"]],standalone:!0,features:[h],decls:9,vars:2,consts:[[1,"container","mt-5"],[1,"fa","fa-check-circle","fa-5x",2,"color","green"],[1,"mb-4"],["class","btn btn-outline-success",3,"routerLink",4,"ngIf"],["routerLink","/orders","class","btn btn-outline-success",4,"ngIf"],[1,"btn","btn-outline-success",3,"routerLink"],["routerLink","/orders",1,"btn","btn-outline-success"]],template:function(t,r){t&1&&(a(0,"div",0)(1,"div"),l(2,"i",1),n(),a(3,"h2"),m(4,"Thank you. Your order is confirmed"),n(),a(5,"p",2),m(6,"Your order has not shipped yet, but this is to be expected as we are not a real store!"),n(),g(7,rt,2,2,"button",3)(8,it,2,0,"button",4),n()),t&2&&(c(7),s("ngIf",r.order),c(),s("ngIf",!r.order))},dependencies:[y,b,De,J]})};function ot(i,e){if(i&1){let t=N();a(0,"li",4)(1,"div",5)(2,"button",6),S("click",function(){let o=I(t).index,d=v();return w(d.onClick(o))}),m(3),n()()()}if(i&2){let t=e.$implicit,r=e.index,o=v();c(2),ke("active",o.selectedIndex===r),s("disabled",!1),c(),_e(" ",t.label," ")}}function nt(i,e){if(i&1&&(a(0,"div"),Ee(1,7),n()),i&2){let t=v();c(),s("ngTemplateOutlet",t.selected.content)}}var ie=class i extends ue{constructor(t,r,o){super(r,t,o);this.cdr=t;this.dir=r;this.elRef=o}linearModeSelected=!0;ngOnInit(){this.linear=this.linearModeSelected}onClick(t){this.selectedIndex=t}next(){this.selectedIndex<this.steps.length-1&&(this.selectedIndex=this.selectedIndex+1,this._stateChanged())}previous(){this.selectedIndex>0&&(this.selectedIndex=this.selectedIndex-1,this._stateChanged())}reset(){this.selectedIndex=0,this._stateChanged()}_stateChanged(){super._stateChanged()}static \u0275fac=function(r){return new(r||i)(p(Pe),p(Ve),p(Se))};static \u0275cmp=f({type:i,selectors:[["app-stepper"]],inputs:{linearModeSelected:"linearModeSelected"},standalone:!0,features:[we([{provide:ue,useExisting:i}]),be,h],decls:4,vars:2,consts:[[1,"container"],[1,"nav","nav-pills","nav-justified"],["class","nav-item",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"nav-item"],[1,"d-grid"],[1,"nav-link","py-3","text-uppercase","fw-bold",3,"click","disabled"],[3,"ngTemplateOutlet"]],template:function(r,o){r&1&&(a(0,"div",0)(1,"ul",1),g(2,ot,4,4,"li",2),n(),g(3,nt,2,1,"div",3),n()),r&2&&(c(2),s("ngForOf",o.steps),c(),s("ngIf",o.selected))},dependencies:[y,Q,b,Oe],styles:["button.nav-link[_ngcontent-%COMP%]{background:#e9ecef;border-radius:0;border:none;color:#333}button.nav-link[_ngcontent-%COMP%]:disabled:not(.active){color:#333;background:#e9ecef}"]})};function st(i,e){if(i&1){let t=N();a(0,"div",6)(1,"div",7)(2,"h4"),m(3,"Shipping address"),n(),a(4,"button",8),S("click",function(){I(t);let o=v();return w(o.saveUserAddress())}),m(5," Save as default address "),n()(),a(6,"div",9)(7,"div",10),l(8,"app-text-input",11),n(),a(9,"div",10),l(10,"app-text-input",12),n(),a(11,"div",10),l(12,"app-text-input",13),n(),a(13,"div",10),l(14,"app-text-input",14),n(),a(15,"div",10),l(16,"app-text-input",15),n(),a(17,"div",10),l(18,"app-text-input",16),n()()()}if(i&2){let t,r=v();s("formGroup",r.checkoutForm),c(4),s("disabled",!((t=r.checkoutForm.get("addressForm"))!=null&&t.valid)||!((t=r.checkoutForm.get("addressForm"))!=null&&t.dirty)),c(4),s("label","First name"),c(2),s("label","Last name"),c(2),s("label","Street"),c(2),s("label","City"),c(2),s("label","State"),c(2),s("label","Zip code")}}var oe=class i{constructor(e,t,r){this.accountService=e;this.toastr=t;this.fb=r}checkoutForm;ngOnInit(){}saveUserAddress(){this.accountService.updateUserAddress(this.checkoutForm?.get("addressForm")?.value).subscribe({next:()=>{this.toastr.success("Address saved"),this.checkoutForm?.get("addressForm")?.reset(this.checkoutForm?.get("addressForm")?.value)},error:e=>{console.error("Error saving address:",e),this.toastr.error(e.message||"Failed to save address")}})}static \u0275fac=function(t){return new(t||i)(p(X),p(M),p(K))};static \u0275cmp=f({type:i,selectors:[["app-checkout-address"]],inputs:{checkoutForm:"checkoutForm"},standalone:!0,features:[h],decls:8,vars:2,consts:[["class","mt-4",3,"formGroup",4,"ngIf"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["routerLink","/basket",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right"],[1,"mt-4",3,"formGroup"],[1,"d-flex","justify-content-between","align-items-center"],[1,"btn","btn-outline-success","mb-3",3,"click","disabled"],["formGroupName","addressForm",1,"row"],[1,"form-group","col-6"],["formControlName","firstName",3,"label"],["formControlName","lastName",3,"label"],["formControlName","street",3,"label"],["formControlName","city",3,"label"],["formControlName","state",3,"label"],["formControlName","zipcode",3,"label"]],template:function(t,r){if(t&1&&(g(0,st,19,8,"div",0),a(1,"div",1)(2,"button",2),l(3,"i",3),m(4," Back to basket "),n(),a(5,"button",4),m(6," Go to Delivery "),l(7,"i",5),n()()),t&2){let o;s("ngIf",r.checkoutForm),c(5),s("disabled",r.checkoutForm==null||(o=r.checkoutForm.get("addressForm"))==null?null:o.invalid)}},dependencies:[Z,Y,ee,y,b,x,O,T,R,L,D,J]})};var A=class i{constructor(e){this.http=e}baseUrl=$.apiUrl;createOrder(e){return this.http.post(this.baseUrl+"orders",e)}getDeliveryMethods(){return this.http.get(this.baseUrl+"orders/deliveryMethods").pipe(he(e=>e.sort((t,r)=>r.price-t.price)))}static \u0275fac=function(t){return new(t||i)(ge(Re))};static \u0275prov=Ce({token:i,factory:i.\u0275fac,providedIn:"root"})};function lt(i,e){if(i&1){let t=N();a(0,"div",9)(1,"div",10)(2,"input",11),S("change",function(){let o=I(t).$implicit,d=v(2);return w(d.setShippingPrice(o))}),n(),a(3,"label",12)(4,"strong"),m(5),Ne(6,"currency"),n(),l(7,"br"),a(8,"span",13),m(9),n(),l(10,"br"),a(11,"small",14),m(12),n()()()()}if(i&2){let t=e.$implicit;c(2),de("id",t.id),s("value",t.id),c(),de("for",t.id),c(2),Ie("",t.shortName," - ",Me(6,7,t.price),""),c(4),G(t.description),c(3),G(t.deliveryTime)}}function mt(i,e){if(i&1&&(a(0,"div",6)(1,"h4"),m(2,"Choose delivery method"),n(),a(3,"div",7),g(4,lt,13,9,"div",8),n()()),i&2){let t=v();s("formGroup",t.checkoutForm),c(4),s("ngForOf",t.deliveryMethods)}}var ne=class i{constructor(e,t){this.checkoutService=e;this.basketService=t}checkoutForm;deliveryMethods;ngOnInit(){this.getDeliveryMethods()}getDeliveryMethods(){this.checkoutService.getDeliveryMethods().subscribe({next:e=>{console.log("Delivery methods loaded:",e),this.deliveryMethods=e},error:e=>{console.error("Error fetching delivery methods",e)}})}setShippingPrice(e){if(this.checkoutForm){let t=this.checkoutForm.get("deliveryForm");t&&(t.get("deliveryMethod")?.setValue(e.id),t.get("shippingPrice")?.setValue(e.price),this.basketService.setShippingPrice(e))}}static \u0275fac=function(t){return new(t||i)(p(A),p(P))};static \u0275cmp=f({type:i,selectors:[["app-checkout-delivery"]],inputs:{checkoutForm:"checkoutForm"},standalone:!0,features:[h],decls:8,vars:2,consts:[["class","mt-4",3,"formGroup",4,"ngIf"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],["cdkStepperNext","",1,"btn","btn-primary",3,"disabled"],[1,"fa","fa-angle-right"],[1,"mt-4",3,"formGroup"],["formGroupName","deliveryForm",1,"row"],["class","col-12 col-md-6 form-group",4,"ngFor","ngForOf"],[1,"col-12","col-md-6","form-group"],[1,"form-check"],["type","radio","formControlName","deliveryMethod",1,"form-check-input",3,"change","id","value"],[1,"form-check-label","ms-2","mb-3",3,"for"],[1,"label-description"],[1,"text-muted"]],template:function(t,r){if(t&1&&(g(0,mt,5,2,"div",0),a(1,"div",1)(2,"button",2),l(3,"i",3),m(4," Back to address "),n(),a(5,"button",4),m(6," Go to Review "),l(7,"i",5),n()()),t&2){let o;s("ngIf",r.checkoutForm&&r.deliveryMethods&&r.deliveryMethods.length>0),c(5),s("disabled",r.checkoutForm==null||(o=r.checkoutForm.get("deliveryForm"))==null?null:o.invalid)}},dependencies:[Te,y,Q,b,x,je,Ae,O,T,R,L,D,Y,Ue],styles:[".form-group[_ngcontent-%COMP%]{cursor:pointer;margin-bottom:1rem}.form-check-input[_ngcontent-%COMP%]{margin-right:.5rem}.form-check-label[_ngcontent-%COMP%]{cursor:pointer;display:block;width:100%;border:1px solid #dee2e6;border-radius:.25rem;padding:1rem;transition:all .2s ease-in-out}.form-check-label[_ngcontent-%COMP%]:hover{background-color:#f8f9fa;border-color:#007bff}.form-check-input[_ngcontent-%COMP%]:checked + .form-check-label[_ngcontent-%COMP%]{background-color:#e3f2fd;border-color:#007bff}.label-description[_ngcontent-%COMP%]{color:#6c757d;font-size:.9em}strong[_ngcontent-%COMP%]{color:#212529}"]})};var ae=class i{constructor(e,t){this.basketService=e;this.toastr=t}appStepper;createPaymentIntent(){this.basketService.createPaymentIntent().subscribe({next:e=>{console.log("Payment intent response:",{paymentIntentId:e.paymentIntentId,clientSecret:e.clientSecret?.substring(0,20)+"...",hasClientSecret:!!e.clientSecret}),this.appStepper?.next()},error:e=>{this.toastr.error(e.message||"Failed to create payment intent")}})}static \u0275fac=function(t){return new(t||i)(p(P),p(M))};static \u0275cmp=f({type:i,selectors:[["app-checkout-review"]],inputs:{appStepper:"appStepper"},standalone:!0,features:[h],decls:9,vars:1,consts:[[1,"container","mt-4"],[3,"isBasket"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-angle-right"]],template:function(t,r){t&1&&(a(0,"div",0),l(1,"app-basket-summary",1),n(),a(2,"div",2)(3,"button",3),l(4,"i",4),m(5," Back to delivery "),n(),a(6,"button",5),S("click",function(){return r.createPaymentIntent()}),m(7," Go to Payment "),l(8,"i",6),n()()),t&2&&(c(),s("isBasket",!1))},dependencies:[ze]})};var Xe="basil",pt=function(e){return e===3?"v3":e},Ke="https://js.stripe.com",dt="".concat(Ke,"/").concat(Xe,"/stripe.js"),ut=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,ft=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,Je="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",vt=function(e){return ut.test(e)||ft.test(e)},ht=function(){for(var e=document.querySelectorAll('script[src^="'.concat(Ke,'"]')),t=0;t<e.length;t++){var r=e[t];if(vt(r.src))return r}return null},$e=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",r=document.createElement("script");r.src="".concat(dt).concat(t);var o=document.head||document.body;if(!o)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return o.appendChild(r),r},Ct=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"7.4.0",startTime:t})},V=null,ce=null,se=null,gt=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},yt=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},St=function(e){return V!==null?V:(V=new Promise(function(t,r){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(Je),window.Stripe){t(window.Stripe);return}try{var o=ht();if(o&&e)console.warn(Je);else if(!o)o=$e(e);else if(o&&se!==null&&ce!==null){var d;o.removeEventListener("load",se),o.removeEventListener("error",ce),(d=o.parentNode)===null||d===void 0||d.removeChild(o),o=$e(e)}se=yt(t,r),ce=gt(r),o.addEventListener("load",se),o.addEventListener("error",ce)}catch(C){r(C);return}}),V.catch(function(t){return V=null,Promise.reject(t)}))},bt=function(e,t,r){if(e===null)return null;var o=t[0],d=o.match(/^pk_test/),C=pt(e.version),E=Xe;d&&C!==E&&console.warn("Stripe.js@".concat(C," was loaded on the page, but @stripe/stripe-js@").concat("7.4.0"," expected Stripe.js@").concat(E,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var F=e.apply(void 0,t);return Ct(F,r),F},B,Ye=!1,Ze=function(){return B||(B=St(null).catch(function(e){return B=null,Promise.reject(e)}),B)};Promise.resolve().then(function(){return Ze()}).catch(function(i){Ye||console.warn(i)});var et=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Ye=!0;var o=Date.now();return Ze().then(function(d){return bt(d,t,o)})};var kt=["cardNumber"],Et=["cardExpiry"],xt=["cardCvc"];function Ft(i,e){if(i&1&&(a(0,"div",10)(1,"div",11)(2,"div",12),l(3,"app-text-input",13),n()(),a(4,"div",14)(5,"div",15)(6,"div",16)(7,"label",17),m(8,"Card Number"),n(),a(9,"div",18),l(10,"div",null,0),n(),a(12,"span",19),m(13),n()()(),a(14,"div",20)(15,"div",16)(16,"label",17),m(17,"Card Expiry"),n(),a(18,"div",18),l(19,"div",null,1),n()()(),a(21,"div",20)(22,"div",16)(23,"label",17),m(24,"Card CVC"),n(),a(25,"div",18),l(26,"div",null,2),n()()()()()),i&2){let t=v();s("formGroup",t.checkoutForm),c(3),s("label","Name on card"),c(10),G(t.cardErrors)}}function _t(i,e){i&1&&l(0,"i",21)}var le=class i{constructor(e,t,r,o){this.basketService=e;this.checkoutService=t;this.toastr=r;this.router=o}checkoutForm;cardNumberElement;cardExpiryElement;cardCvcElement;stripe=null;cardNumber;cardExpiry;cardCvc;cardNumberComplete=!1;cardExpiryComplete=!1;cardCvcComplete=!1;cardErrors;loading=!1;initRetryCount=0;maxRetries=20;ngOnInit(){}ngAfterViewInit(){setTimeout(()=>{this.initializeStripe()},0)}ngOnChanges(e){e.checkoutForm&&e.checkoutForm.currentValue&&!this.stripe&&(this.initRetryCount=0,setTimeout(()=>this.initializeStripe(),100))}initializeStripe(){if(!this.checkoutForm){this.initRetryCount<this.maxRetries&&(this.initRetryCount++,setTimeout(()=>this.initializeStripe(),100));return}if(!this.cardNumberElement?.nativeElement||!this.cardExpiryElement?.nativeElement||!this.cardCvcElement?.nativeElement){this.initRetryCount<this.maxRetries&&(this.initRetryCount++,setTimeout(()=>this.initializeStripe(),100));return}this.initRetryCount=0;let e=this.cardNumberElement.nativeElement,t=this.cardExpiryElement.nativeElement,r=this.cardCvcElement.nativeElement,o=e.parentElement,d=t.parentElement,C=r.parentElement;this.clearElementContent(e),this.clearElementContent(t),this.clearElementContent(r),e.removeAttribute("class"),t.removeAttribute("class"),r.removeAttribute("class"),et($.stripePublishableKey).then(E=>{this.stripe=E;let F=E?.elements();if(F){let pe={base:{fontSize:"16px",color:"#495057",fontFamily:'"Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',"::placeholder":{color:"#6c757d"}},invalid:{color:"#dc3545"}};this.cardNumber=F.create("cardNumber",{style:pe}),this.cardNumber.mount(e),this.cardNumber.on("change",u=>{this.cardNumberComplete=u.complete,u.error?(this.cardErrors=u.error.message,o?.classList.add("has-error"),o?.classList.remove("is-complete")):(this.cardErrors=null,o?.classList.remove("has-error"),u.complete?o?.classList.add("is-complete"):o?.classList.remove("is-complete"))}),this.cardExpiry=F.create("cardExpiry",{style:pe}),this.cardExpiry.mount(t),this.cardExpiry.on("change",u=>{this.cardExpiryComplete=u.complete,u.error?(this.cardErrors=u.error.message,d?.classList.add("has-error"),d?.classList.remove("is-complete")):(this.cardErrors=null,d?.classList.remove("has-error"),u.complete?d?.classList.add("is-complete"):d?.classList.remove("is-complete"))}),this.cardCvc=F.create("cardCvc",{style:pe}),this.cardCvc.mount(r),this.cardCvc.on("change",u=>{this.cardCvcComplete=u.complete,u.error?(this.cardErrors=u.error.message,C?.classList.add("has-error"),C?.classList.remove("is-complete")):(this.cardErrors=null,C?.classList.remove("has-error"),u.complete?C?.classList.add("is-complete"):C?.classList.remove("is-complete"))})}}).catch(E=>{console.error("Error loading Stripe:",E)})}clearElementContent(e){for(;e.firstChild;)e.removeChild(e.firstChild);e.textContent="",e.innerHTML=""}get paymentFormComplete(){return this.checkoutForm?.get("paymentForm")?.valid&&this.cardNumberComplete&&this.cardExpiryComplete&&this.cardCvcComplete}submitOrder(){return U(this,null,function*(){this.loading=!0;let e=this.basketService.getCurrentBasketValue();if(!e)throw new Error("cannot get basket");try{let t=yield this.createOrder(e),r=yield this.confirmPaymentWithStripe(e);if(r.paymentIntent){this.basketService.deleteBasket(e);let o={state:t};this.router.navigate(["checkout/success"],o)}else this.toastr.error(r.error.message)}catch(t){console.log(t),this.toastr.error(t.message)}finally{this.loading=!1}})}confirmPaymentWithStripe(e){return U(this,null,function*(){if(!e)throw new Error("Basket is null");if(!e.clientSecret)throw new Error("No client secret available");console.log("Confirming payment with:",{paymentIntentId:e.paymentIntentId,clientSecret:e.clientSecret?.substring(0,20)+"..."});let t=this.stripe?.confirmCardPayment(e.clientSecret,{payment_method:{card:this.cardNumber,billing_details:{name:this.checkoutForm?.get("paymentForm")?.get("nameOnCard")?.value}}});if(!t)throw new Error("Problem attempting payment with stripe");return t})}createOrder(e){return U(this,null,function*(){if(!e)throw new Error("Basket is null");let t=this.getOrderToCreate(e);return ve(this.checkoutService.createOrder(t))})}getOrderToCreate(e){let t=this.checkoutForm?.get("deliveryForm")?.get("deliveryMethod")?.value,r=this.checkoutForm?.get("addressForm")?.value;if(!t||!r)throw new Error("Problem with basket");return{basketId:e.id,deliveryMethodId:t,shipToAddress:r}}static \u0275fac=function(t){return new(t||i)(p(P),p(A),p(M),p(W))};static \u0275cmp=f({type:i,selectors:[["app-checkout-payment"]],viewQuery:function(t,r){if(t&1&&(q(kt,5),q(Et,5),q(xt,5)),t&2){let o;z(o=H())&&(r.cardNumberElement=o.first),z(o=H())&&(r.cardExpiryElement=o.first),z(o=H())&&(r.cardCvcElement=o.first)}},inputs:{checkoutForm:"checkoutForm"},standalone:!0,features:[ye,h],decls:9,vars:3,consts:[["cardNumber",""],["cardExpiry",""],["cardCvc",""],["class","mt-4",3,"formGroup",4,"ngIf"],[1,"d-flex","justify-content-between","flex-row","mb-5"],["cdkStepperPrevious","",1,"btn","btn-outline-primary"],[1,"fa","fa-angle-left"],[1,"btn","btn-primary",3,"click","disabled"],[1,"fa","fa-angle-right"],["class","fa fa-spinner fa-spin",4,"ngIf"],[1,"mt-4",3,"formGroup"],[1,"row"],["formGroupName","paymentForm",1,"form-group","col-12"],["formControlName","nameOnCard",3,"label"],[1,"row","mb-3"],[1,"col-6"],[1,"form-group"],[1,"form-label"],[1,"stripe-container"],[1,"text-danger"],[1,"col-3"],[1,"fa","fa-spinner","fa-spin"]],template:function(t,r){t&1&&(g(0,Ft,28,3,"div",3),a(1,"div",4)(2,"button",5),l(3,"i",6),m(4," Back to review "),n(),a(5,"button",7),S("click",function(){return r.submitOrder()}),m(6," Submit order "),l(7,"i",8),g(8,_t,1,0,"i",9),n()()),t&2&&(s("ngIf",r.checkoutForm),c(5),s("disabled",r.loading||!r.paymentFormComplete),c(3),s("ngIf",r.loading))},dependencies:[ee,x,O,T,R,L,D,y,b],styles:[".stripe-container[_ngcontent-%COMP%]{border:1px solid #ced4da;border-radius:.375rem;background-color:#fff;padding:.75rem;min-height:calc(1.5em + .75rem + 2px);transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out}.stripe-container[_ngcontent-%COMP%]:focus-within{border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.stripe-container[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%;height:100%}.StripeElement[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5;color:#495057;font-family:Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif}.StripeElement[_ngcontent-%COMP%]:focus{outline:none}.StripeElement--focus[_ngcontent-%COMP%]{outline:none}.StripeElement--invalid[_ngcontent-%COMP%]{color:#dc3545}.StripeElement--complete[_ngcontent-%COMP%]{color:#28a745}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{margin-bottom:.5rem;font-weight:500;color:#495057}.stripe-container.has-error[_ngcontent-%COMP%]{border-color:#dc3545;box-shadow:0 0 0 .2rem #dc354540}.stripe-container.is-complete[_ngcontent-%COMP%]{border-color:#28a745}"]})};var me=class i{constructor(e,t){this.fb=e;this.accountService=t}checkoutForm;ngOnInit(){this.createCheckoutForm(),this.getAddressFormValues()}createCheckoutForm(){this.checkoutForm=this.fb.group({addressForm:this.fb.group({firstName:[null,k.required],lastName:[null,k.required],street:[null,k.required],city:[null,k.required],state:[null,k.required],zipcode:[null,k.required]}),deliveryForm:this.fb.group({deliveryMethod:[null,k.required],shippingPrice:[null,k.required]}),paymentForm:this.fb.group({nameOnCard:[null,k.required]})})}getAddressFormValues(){this.accountService.getUserAddress().subscribe({next:e=>{e&&this.checkoutForm.get("addressForm")?.patchValue({firstName:e.firstName,lastName:e.lastName,street:e.street,city:e.city,state:e.state,zipcode:e.zipcode})},error:e=>{console.error("Error fetching address",e)}})}static \u0275fac=function(t){return new(t||i)(p(K),p(X))};static \u0275cmp=f({type:i,selectors:[["app-checkout"]],standalone:!0,features:[h],decls:15,vars:11,consts:[["appStepper",""],[1,"container","mt-5"],[1,"row"],[1,"col-8"],[3,"label","completed"],[3,"checkoutForm"],[3,"label"],[3,"appStepper"],[1,"col-4"]],template:function(t,r){if(t&1&&(a(0,"div",1)(1,"div",2)(2,"div",3)(3,"app-stepper",null,0)(5,"cdk-step",4),l(6,"app-checkout-address",5),n(),a(7,"cdk-step",4),l(8,"app-checkout-delivery",5),n(),a(9,"cdk-step",6),l(10,"app-checkout-review",7),n(),a(11,"cdk-step",4),l(12,"app-checkout-payment",5),n()()(),a(13,"div",8),l(14,"app-order-totals"),n()()()),t&2){let o,d,C,E=Fe(4);c(5),s("label","Address")("completed",(o=r.checkoutForm.get("addressForm"))==null?null:o.valid),c(),s("checkoutForm",r.checkoutForm),c(),s("label","Delivery")("completed",(d=r.checkoutForm.get("deliveryForm"))==null?null:d.valid),c(),s("checkoutForm",r.checkoutForm),c(),s("label","Review"),c(),s("appStepper",E),c(),s("label","Payment")("completed",(C=r.checkoutForm.get("paymentForm"))==null?null:C.valid),c(),s("checkoutForm",r.checkoutForm)}},dependencies:[y,Ge,qe,ie,Z,Be,oe,ne,ae,le,x]})};var Rr=[{path:"",component:me},{path:"success",component:te,canActivate:[Le],data:{breadcrumb:"Success"}}];export{Rr as routes};
