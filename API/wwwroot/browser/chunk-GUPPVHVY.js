import{C as b,Lb as g,c as u,j as d,wb as f,z as h}from"./chunk-LQR3BN6S.js";var a=[];for(let i=0;i<256;++i)a.push((i+256).toString(16).slice(1));function B(i,t=0){return(a[i[t+0]]+a[i[t+1]]+a[i[t+2]]+a[i[t+3]]+"-"+a[i[t+4]]+a[i[t+5]]+"-"+a[i[t+6]]+a[i[t+7]]+"-"+a[i[t+8]]+a[i[t+9]]+"-"+a[i[t+10]]+a[i[t+11]]+a[i[t+12]]+a[i[t+13]]+a[i[t+14]]+a[i[t+15]]).toLowerCase()}var m,x=new Uint8Array(16);function p(){if(!m){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");m=crypto.getRandomValues.bind(crypto)}return m(x)}var y=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),c={randomUUID:y};function v(i,t,e){if(c.randomUUID&&!t&&!i)return c.randomUUID();i=i||{};let r=i.random??i.rng?.()??p();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(e=e||0,e<0||e+16>t.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let s=0;s<16;++s)t[e+s]=r[s];return t}return B(r)}var l=v;var o=class{id=l();items=[];shippingPrice=0};var I=class i{constructor(t){this.http=t}baseUrl=g.apiUrl;basketSource=new u(null);basket$=this.basketSource.asObservable();basketTotalSource=new u(null);basketTotal$=this.basketTotalSource.asObservable();shipping=0;setShippingPrice(t){let e=this.getCurrentBasketValue();e&&(this.shipping=t.price,e.deliveryMethodId=t.id,e.shippingPrice=t.price,this.setBasket(e))}getBasket(t){return this.http.get(this.baseUrl+"basket?id="+t).pipe(d(e=>(this.basketSource.next(e),this.calculateTotals(),e)))}setBasket(t){return this.http.post(this.baseUrl+"basket",t).subscribe({next:e=>{this.basketSource.next(e),this.calculateTotals()},error:e=>{console.error("Error setting basket:",e)}})}getCurrentBasketValue(){return this.basketSource.value}addItemToBasket(t,e=1){let r=this.mapProductItemToBasketItem(t,e),s=this.getCurrentBasketValue()??this.getCreateBasket();s.items=this.addOrUpdateItem(s.items,r,e),this.setBasket(s)}incrementItemQuantity(t){let e=this.getCurrentBasketValue(),r=e?.items.findIndex(s=>s.id===t.id);e&&e.items&&(r!==void 0&&r>=0&&e.items[r].quantity++,this.setBasket(e))}decrementItemQuantity(t){let e=this.getCurrentBasketValue(),r=e?.items.findIndex(s=>s.id===t.id);e&&e.items&&r!==void 0&&r>=0&&(e.items[r].quantity>1?(e.items[r].quantity--,this.setBasket(e)):this.removeItemFromBasket(t))}removeItemFromBasketById(t,e){let r=this.getCurrentBasketValue();if(r){let s=r.items.find(n=>n.id===t);if(s)if(s.quantity>e)s.quantity-=e,this.setBasket(r);else return this.removeItemFromBasket(s)}}removeItemFromBasket(t){let e=this.getCurrentBasketValue();e?.items.some(r=>r.id===t.id)&&(e.items=e.items.filter(r=>r.id!==t.id),e.items.length>0?this.setBasket(e):this.deleteBasket(e))}deleteBasket(t){return this.http.delete(this.baseUrl+"basket?id="+t.id).subscribe({next:()=>{this.basketSource.next(null),this.basketTotalSource.next(null),localStorage.removeItem("basket_id")},error:e=>{console.error("Error deleting basket:",e)}})}calculateTotals(){let t=this.getCurrentBasketValue(),e=this.shipping,r=t?.items.reduce((n,k)=>k.price*k.quantity+n,0),s=(r??0)+(t?.shippingPrice??0);this.basketTotalSource.next({shipping:t?.shippingPrice??0,total:s,subtotal:r??0})}addOrUpdateItem(t,e,r){let s=t.findIndex(n=>n.id===e.id);return s===-1?(e.quantity=r,t.push(e)):t[s].quantity+=r,t}getCreateBasket(){let t=new o;return localStorage.setItem("basket_id",t.id),t}mapProductItemToBasketItem(t,e){return{id:t.id,productName:t.name,price:t.price,quantity:e,pictureUrl:t.pictureUrl,brand:t.productBrand,type:t.productType}}clearPaymentIntent(){let t=this.getCurrentBasketValue();t&&(t.paymentIntentId=void 0,t.clientSecret=void 0,this.setBasket(t))}createPaymentIntent(){return this.http.post(this.baseUrl+"payments/"+this.getCurrentBasketValue()?.id,{}).pipe(d(t=>(this.basketSource.next(t),t)))}isProduct(t){return t.productBrand!==void 0}static \u0275fac=function(e){return new(e||i)(b(f))};static \u0275prov=h({token:i,factory:i.\u0275fac,providedIn:"root"})};export{I as a};
