<div class="d-flex justify-content-center mt-5">
    <div class="col-3">
        <!-- Debug info -->
        <div class="alert alert-info mb-3" *ngIf="email || token">
            <small>
                <strong>Debug Info:</strong><br>
                Email: {{ email || 'Not found' }}<br>
                Token: {{ token ? (token.substring(0, 30) + '...') : 'Not found' }}
            </small>
        </div>

        <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
            <div class="text-center mb-4">
                <h1 class="h3 mb-3 font-weight-normal">Reset Password</h1>
                <p class="text-muted">Enter your new password below.</p>
            </div>

            <div *ngIf="successMessage" class="alert alert-success" role="alert">
                {{ successMessage }}
                <div class="mt-2">Redirecting to login...</div>
            </div>

            <div *ngIf="errorMessage" class="alert alert-danger" role="alert">
                {{ errorMessage }}
            </div>

            <div *ngIf="!errorMessage || email">
                <app-text-input 
                    formControlName="newPassword" 
                    [label]="'New Password'"
                    [type]="'password'">
                </app-text-input>

                <app-text-input 
                    formControlName="confirmPassword" 
                    [label]="'Confirm Password'"
                    [type]="'password'">
                </app-text-input>

                <div *ngIf="resetPasswordForm.hasError('mismatch') && resetPasswordForm.get('confirmPassword')?.touched" 
                     class="text-danger mb-2">
                    Passwords do not match
                </div>

                <div class="mb-3 text-muted small">
                    Password must contain:
                    <ul class="mb-0 mt-1">
                        <li>At least 8 characters</li>
                        <li>One uppercase letter</li>
                        <li>One lowercase letter</li>
                        <li>One number</li>
                        <li>One special character</li>
                    </ul>
                </div>

                <button 
                    [disabled]="resetPasswordForm.invalid || submitted || !email || !token" 
                    class="btn btn-lg btn-primary btn-block mb-3" 
                    type="submit" 
                    style="width: 100%;">
                    {{ submitted ? 'Resetting...' : 'Reset Password' }}
                </button>
            </div>

            <div class="text-center">
                <a routerLink="/account/login" class="text-decoration-none">Back to Login</a>
            </div>
        </form>
    </div>
</div>
